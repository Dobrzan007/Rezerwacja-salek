<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utw√≥rz konto - System Rezerwacji Sal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .create-container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
        }
        
        .create-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .create-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .create-header p {
            color: #7f8c8d;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin-bottom: 15px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-secondary {
            background: #95a5a6;
            text-decoration: none;
            display: block;
            text-align: center;
        }
        
        .btn-secondary:hover {
            background: #7f8c8d;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .btn-tab {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .btn-tab.active {
            background: #3498db;
        }
        
        .btn-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .admin-list {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .admin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .admin-item:last-child {
            border-bottom: none;
        }
        
        .admin-item:hover {
            background: #e9ecef;
        }
        
        .admin-item.selected {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }
        
        .admin-info {
            flex-grow: 1;
        }
        
        .admin-username {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .admin-email {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .delete-form {
            display: none;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .delete-form.active {
            display: block;
        }
        
        .delete-warning {
            color: #721c24;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="create-container">
        <div class="create-header">
            <h1>üë§ ZarzƒÖdzanie kontami admin√≥w</h1>
            <p>System Rezerwacji Sal - DACPOL</p>
        </div>
        
        <div class="button-group">
            <button class="btn-tab active" onclick="showTab('create')">‚ûï Utw√≥rz konto</button>
            <button class="btn-tab" onclick="showTab('delete')">üóëÔ∏è Usu≈Ñ konto</button>
        </div>
        
        <div id="message"></div>
        
        <!-- Tab: Tworzenie konta -->
        <div id="createTab" class="tab-content active">
            <div class="warning">
                <strong>‚ö†Ô∏è Uwaga:</strong> Do utworzenia konta administratora potrzebne jest has≈Ço g≈Ç√≥wne.
            </div>
            
            <form id="createAdminForm">
                <div class="form-group">
                    <label for="username">Nazwa u≈ºytkownika:</label>
                    <input type="text" id="username" name="username" required>
                    <small>Nazwa do logowania (np. "administrator", "admin")</small>
                </div>
                
                <div class="form-group">
                    <label for="password">Has≈Ço:</label>
                    <input type="password" id="password" name="password" required>
                    <small>Wybierz silne has≈Ço</small>
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" name="email" required>
                    <small>Email do powiadomie≈Ñ o rezerwacjach</small>
                </div>
                
                <div class="form-group">
                    <label for="masterPassword">Has≈Ço g≈Ç√≥wne:</label>
                    <input type="password" id="masterPassword" name="masterPassword" required>
                    <small>Has≈Ço wymagane do tworzenia nowych kont administrator√≥w</small>
                </div>
                
                <button type="submit" class="btn">Utw√≥rz konto</button>
            </form>
        </div>
        
        <!-- Tab: Usuwanie konta -->
        <div id="deleteTab" class="tab-content">
            <div class="warning">
                <strong>‚ö†Ô∏è Uwaga:</strong> Usuniƒôcie konta administratora jest nieodwracalne!
            </div>
            
            <div class="form-group">
                <label>Wybierz konto do usuniƒôcia:</label>
                <div id="adminList" class="admin-list">
                    <div style="text-align: center; color: #7f8c8d; padding: 20px;">
                        ≈Åadowanie listy administrator√≥w...
                    </div>
                </div>
            </div>
            
            <div id="deleteForm" class="delete-form">
                <div class="delete-warning">
                    ‚ö†Ô∏è Czy na pewno chcesz usunƒÖƒá konto: <span id="selectedAdminName"></span>?
                </div>
                
                <div class="form-group">
                    <label for="deletePassword">Wpisz has≈Ço do konta <span id="selectedAdminNameInput"></span>:</label>
                    <input type="password" id="deletePassword" name="deletePassword" required>
                    <small>Musisz podaƒá has≈Ço do usuwanego konta w celu potwierdzenia</small>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button type="button" class="btn" onclick="confirmDeleteAdmin()">Usu≈Ñ konto</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelDelete()">Anuluj</button>
                </div>
            </div>
        </div>
        
        <a href="/" class="btn btn-secondary">‚óÄ Powr√≥t do kalendarza</a>
    </div>

    <script>
        let selectedAdmin = null;
        
        // Funkcja prze≈ÇƒÖczania zak≈Çadek
        function showTab(tabName) {
            // Ukryj wszystkie zak≈Çadki
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Usu≈Ñ aktywne style z przycisk√≥w
            document.querySelectorAll('.btn-tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Poka≈º wybranƒÖ zak≈Çadkƒô
            if (tabName === 'create') {
                document.getElementById('createTab').classList.add('active');
                document.querySelector('.btn-tab[onclick*="create"]').classList.add('active');
            } else if (tabName === 'delete') {
                document.getElementById('deleteTab').classList.add('active');
                document.querySelector('.btn-tab[onclick*="delete"]').classList.add('active');
                loadAdminList();
            }
            
            // Wyczy≈õƒá komunikaty
            document.getElementById('message').innerHTML = '';
        }
        
        // Funkcja ≈Çadowania listy admin√≥w
        async function loadAdminList() {
            try {
                const response = await fetch('/api/admins');
                const admins = await response.json();
                
                const adminListDiv = document.getElementById('adminList');
                
                if (admins.length === 0) {
                    adminListDiv.innerHTML = '<div style="text-align: center; color: #7f8c8d; padding: 20px;">Brak kont administrator√≥w</div>';
                    return;
                }
                
                let html = '';
                admins.forEach(admin => {
                    html += `
                        <div class="admin-item" onclick="selectAdmin('${admin.username}', '${admin.email}')">
                            <div class="admin-info">
                                <div class="admin-username">${admin.username}</div>
                                <div class="admin-email">${admin.email}</div>
                            </div>
                        </div>
                    `;
                });
                
                adminListDiv.innerHTML = html;
                
            } catch (error) {
                document.getElementById('adminList').innerHTML = '<div style="color: #e74c3c; text-align: center; padding: 20px;">B≈ÇƒÖd ≈Çadowania listy admin√≥w</div>';
            }
        }
        
        // Funkcja wybierania admina do usuniƒôcia
        function selectAdmin(username, email) {
            // Usu≈Ñ poprzednie zaznaczenie
            document.querySelectorAll('.admin-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Zaznacz wybrany element
            event.target.closest('.admin-item').classList.add('selected');
            
            selectedAdmin = username;
            document.getElementById('selectedAdminName').textContent = username;
            document.getElementById('selectedAdminNameInput').textContent = username;
            document.getElementById('deleteForm').classList.add('active');
            document.getElementById('deletePassword').value = '';
        }
        
        // Funkcja anulowania usuwania
        function cancelDelete() {
            selectedAdmin = null;
            document.getElementById('deleteForm').classList.remove('active');
            document.querySelectorAll('.admin-item').forEach(item => {
                item.classList.remove('selected');
            });
        }
        
        // Funkcja potwierdzania usuniƒôcia
        async function confirmDeleteAdmin() {
            if (!selectedAdmin) {
                showMessage('Wybierz konto do usuniƒôcia', 'error');
                return;
            }
            
            const password = document.getElementById('deletePassword').value;
            if (!password) {
                showMessage('Wpisz has≈Ço do konta', 'error');
                return;
            }
            
            try {
                const response = await fetch(`/api/admins/${selectedAdmin}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage(`Konto ${selectedAdmin} zosta≈Ço usuniƒôte`, 'success');
                    cancelDelete();
                    loadAdminList(); // Od≈õwie≈º listƒô
                } else {
                    showMessage('B≈ÇƒÖd: ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('B≈ÇƒÖd po≈ÇƒÖczenia: ' + error.message, 'error');
            }
        }
        
        // Funkcja wy≈õwietlania komunikat√≥w
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            const className = type === 'success' ? 'success' : 'error';
            messageDiv.innerHTML = `<div class="${className}">${text}</div>`;
            
            // Automatyczne ukrycie komunikatu po 5 sekundach
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }
        
        // Formularz tworzenia konta
        document.getElementById('createAdminForm').onsubmit = async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const email = document.getElementById('email').value;
            const masterPassword = document.getElementById('masterPassword').value;
            
            try {
                const response = await fetch('/create_admin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password, email, master_password: masterPassword })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('Konto utworzone pomy≈õlnie!', 'success');
                    document.getElementById('createAdminForm').reset();
                    
                    // Je≈õli jeste≈õmy na zak≈Çadce usuwania, od≈õwie≈º listƒô
                    if (document.getElementById('deleteTab').classList.contains('active')) {
                        loadAdminList();
                    }
                } else {
                    showMessage('B≈ÇƒÖd: ' + result.error, 'error');
                }
            } catch (error) {
                showMessage('B≈ÇƒÖd po≈ÇƒÖczenia: ' + error.message, 'error');
            }
        };
    </script>
</body>
</html>
